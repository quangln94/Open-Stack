# Kiến trúc của Neutron
## 1. Neutron
Neutron có 3 core resources:
- Ports: Ports trong Neutron đề cấp đến kết nối tới virtual switch. Các kết nối là nới các instances và network services được gắn vào networks. Khi được gắn vào subnets, địa chỉ MAC và IP được gắn vào instance.
- Networks: Neutron định nghĩa networks như isolated Layer 2 network segments. Người vận hành sẽ nhìn networks như logical switches như Linux bridging, Open vSwitch, hoặc phấn mềm virtual switch ảo khác. Không giống như physical networks, cả người vận hành hoặc người dùng trong OpenStack có thể định nghĩa chúng.
- Subnet: Subnets trong Neutron đại diện cho 1 block IP được gắn cho 1 network. IP từ block được gán vào ports.

Neutron cung cấp thếm các resources sau:
- Routers: Routers cung cấp gateways giữa các networks.
- Private IPs: Neutron định nghĩa 2 loại networks:
  - Tenant networks: Tenant networks sử đụng địa chỉ IP privates. IP Private chỉ hoạt động trong 1 tenan và độc lập với bên ngoài.
  - External networks: External networks có thể đi ra Internet.
- Floating IPs: 1 floating IP là 1 IP của external network để Neutron maps tới IP private của 1 instance. Floating IP được gán cho 1 instance để có thể connect tới external networks và truy cập Internet. Neutron ánh xạ floating IPs đến private IP sử dụng NAT.

Neutron cũng cung cấp các advanced services để thêm các rule tới network OpenStack: 
- Load Balancing as a Service (LBaaS) để phân phối traffic giũa nhiều instances trong Node Compute.
- Firewall as a Service (FWaaS) để secure network layer 3 và layer 4
- Virtual Private Network as a Service (VPNaaS) để build secured tunnels giữa các instances hoặc các hosts

## 2. Kiến trúc của Neutron

Neutron cho phép build và quản lý 1 network topology bao gồm: networks, subnets, routers, load balancers, firewalls...

Neutron gồm 3 thành phần chính:
- Neutron server: Nó chấp nhận cấc request API và định tuyến chúng đến các Neutron plugin thích hợp
- Neutron plugins: Thực hiện các công việc thực tế cho việc điều phối các backend device như cắm hoặc rút port, tạo network và subnets, đánh địa chỉ IP.
- Neutron agents: Neutron agents chạy trên Node Compute hoặc Node Network. Agent nhận các lệnh từ Neutron server và mang các thay đổi lên Node Compute hoặc Node Network. Các loại Neutron agent khác nhau thực hiện chức năng khác nhau. Ví dụ, Open vSwitch agent thực hiện kết nối L2 bằng cách cắm và rút port trên Open vSwitch (OVS) và chạy trên cả Node Compute và Node Network, trong khi L3 agent chỉ chạy trên các Node Network và cung cấp dịch vụ Routing và NAT.

## 2.2. Service plugin

Service plugin được gọi để triển khai các networks servie như: firewall, load balances hoặc tạo VPN serivces. Ví dụ: L3 service plugin triển khai virtual router cung cấp kết nối giữa các network. Nó cũng tạo Neutron resources được gọi là Floating IP cung cấp NAT để expose 1 VM ra Internet.

## 2.3 Agent

Agents được triển khai trên Node Network và Node Compute. Agent tương tác với Neutron server sử dụng RPC calls qua message bus. Neutron cung cấp type khác nhau đến agents để thực thi virtual networking service như kết nối Layer 2, DHCP serice và Router.
